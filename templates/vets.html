{% extends 'base.html' %}
{% block body %}
<h1>Weterynarze</h1>
<p>Poniżej przedstawiona została lista weterynarzy dyżurujących w naszej klinice.
  Możesz edytować ich dane klikając w ID,
  wybierając opcję do zmiany a następnie wpisując pożądaną wartość. </p>
<p>Możesz również zarejestrować nowego weterynarza, korzystając z poniższego guzika</p>
<input type="button" id="add_vet" value="Zarejestruj nowego weterynarza">
<div id="add_vet_box">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script>
    $('#add_vet').on('click', function(){
      if($('#name_input').length == 0) {

        var $name_label = $('<label>Imie weterynarza</label>');
        var $name_input = $('<input>')
        .attr('id', 'name_input')
        .attr('type', 'text');

        var $surname_label = $('<label>Nazwisko weterynarza</label>');
        var $surname_input = $('<input>')
        .attr('id', 'surname_input')
        .attr('type', 'text');

        var $type_label = $('<label>Rodzaj wizyty</label>');
        var $type_input = $('<input>')
        .attr('id', 'type_input')
        .attr('type', 'text');

        var $submit_button = $('<input>')
        .attr('type', 'button')
        .attr('id', 'submit_button')
        .attr('value', 'Zarejestruj');

        $('#add_vet_box').append($name_label, $name_input, $surname_label, $surname_input, $type_label,
                        $type_input, $submit_button);

        $('#submit_button').on('click', function(){

          var $name_val = $('#name_input').val()
          var $surname_val = $('#surname_input').val();
          var $type_val = $('#type_input').val();

          $.ajax({
            url: '/api/vets'.concat('?key=1234'),
            method: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({"name": $name_val,
                                  "surname": $surname_val,
                                  "appointment_type": $type_val})
          }).done(function(data){
            $.ajax({
              url: '/vets',
              method: 'GET',

            }).done(function(data){
              $('body').html(data);
            });
          });
        });
      };
    });
  </script>
</div>
<table>
  <tr>
    {% for header in headers %}
    <th>{{ header }}</th>
    {% endfor %}
  </tr>
  {% for row in table %}
    <tr>
      <td class="vet_id">{{ row[0] }}</td>
      {% for item in row[1:] %}
      <td>{{ item }}</td>
      {% endfor %}
    </tr>
  {% endfor %}
</table>
<select id="remove_id">
  {% for row in table %}
  <option value="{{ row[0] }}">{{ row[0] }}</option>
  {% endfor %}
</select>
<input type="button" id="remove_vet" value="Usuń weterynarza">
<script>
  $('#remove_vet').on('click', function(){
      var $vet_id = $('#remove_id').val();

      $.ajax({
        url: '/api/vets/'.concat($vet_id, '?key=1234'),
        method: 'DELETE'
      }).done(function(data){
        $.ajax({
          url: '/vets',
          method: 'GET'
        }).done(function(data){
          $('body').html(data);
        });
      });
    });


</script>
{% endblock %}